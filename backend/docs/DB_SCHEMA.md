# Database Schema

## Articles Collection

Collection path: `articles`

### Fields

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| id | string | Yes | Auto-generated document ID |
| title | string | Yes | Article title |
| description | string | No | Brief description/summary of the article |
| content | string | Yes | Full article content |
| author | string | Yes | Author name |
| userId | string | Yes | User ID of the article author |
| thumbnailURL | string | Yes | Reference to image in Firebase Cloud Storage (path: `media/articles/{articleId}/{imageName}`) |
| publishedAt | timestamp | Yes | Publication timestamp (server timestamp) |
| createdAt | timestamp | Yes | Creation timestamp (server timestamp) |
| updatedAt | timestamp | Yes | Last update timestamp (server timestamp) |

### Example Document

```json
{
  "id": "abc123def456",
  "title": "Breaking News!",
  "description": "This is breaking news! Arnold Schwarzenegger has been seen with a 20 year old male human in the park.",
  "content": "This is breaking news! Arnold Schwarzenegger has been seen with a 20 year old male human in the park. Arnold is 78 years old. will he terminate him?",
  "author": "John Doe",
  "userId": "user123xyz",
  "thumbnailURL": "media/articles/abc123def456/breaking-news-thumbnail.jpg",
  "publishedAt": "2024-03-23T12:00:00Z",
  "createdAt": "2024-03-23T11:55:00Z",
  "updatedAt": "2024-03-23T12:00:00Z"
}
```

## Users Collection

Collection path: `users`

### Fields

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| uid | string | Yes | User ID (matches Firebase Auth UID) |
| email | string | Yes | User email address |
| displayName | string | No | User display name |
| createdAt | timestamp | Yes | Account creation timestamp |
| updatedAt | timestamp | Yes | Last update timestamp |

### Subcollection: favorites

Collection path: `users/{userId}/favorites`

This subcollection stores user-specific bookmarked articles. Each user has their own favorites subcollection, ensuring bookmarks are isolated per user.

#### Fields

| Field Name | Type | Required | Description |
|------------|------|----------|-------------|
| articleId | string | Yes | ID of the bookmarked article (also used as document ID) |
| favoritedAt | timestamp | Yes | When the article was bookmarked |

#### Example Document

```json
// Path: users/user123xyz/favorites/abc123def456
{
  "articleId": "abc123def456",
  "favoritedAt": "2024-03-23T14:30:00Z"
}
```

### How User-Specific Bookmarks Work

1. **Adding a bookmark**: When User A bookmarks an article with ID "article123", a document is created at `users/userA_id/favorites/article123`
2. **Removing a bookmark**: The document at `users/userA_id/favorites/article123` is deleted
3. **Loading bookmarks**: Query `users/userA_id/favorites/` to get all article IDs, then fetch the corresponding articles from the `articles` collection
4. **Isolation**: Each user's bookmarks are completely separate. User A and User B can both bookmark the same article without affecting each other

## Storage Structure

### Firebase Cloud Storage Organization

```
media/
  └── articles/
      └── {articleId}/
          └── {imageName}
```

**Example:**
- `media/articles/abc123def456/thumbnail.jpg`
- `media/articles/xyz789ghi012/breaking-news.png`

### Storage Rules

Images are stored in Firebase Cloud Storage with the following structure:
- Each article has its own folder identified by the article document ID
- The `thumbnailURL` field in Firestore contains the storage path reference
- Storage rules enforce authentication and file size limits

## Indexes

### Composite Indexes

1. **By publish date (descending)**
   - Collection: `articles`
   - Fields indexed: `publishedAt` (Descending)
   - Purpose: Retrieve articles sorted by most recent first

2. **By author and date**
   - Collection: `articles`
   - Fields indexed: `author` (Ascending), `publishedAt` (Descending)
   - Purpose: Query articles by specific author, sorted by date

## Notes

- All timestamps use Firebase server timestamp for consistency
- Article IDs are auto-generated by Firestore
- Images must be uploaded to Cloud Storage before creating the article document
- The `thumbnailURL` stores the Cloud Storage path, not a direct URL
- **Bookmarks/Favorites are stored per user** in the `users/{userId}/favorites` subcollection, not as a field on the article document
- The `userId` field on articles links articles to their authors
